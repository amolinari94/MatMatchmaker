
@page "/SignUp"
@using DataAccessLibrary.Models
@using BlazorApp.Models
@using DataAccessLibrary
@inject IProfileData _db

@rendermode InteractiveServer



<PageTitle>SignUp</PageTitle>
<head>

</head>
<div style="text-align: center;">
    <img src="Logo.png" width="300" height="200" style="display: inline-block;">
</div>
<h1 class="center-title">Sign Up</h1>

<body class="SignUp-body">

<EditForm Model="@newProfile" OnSubmit="@InsertProfile">
    <InputText id ="email" @bind-Value="newProfile.email"/>
    <InputText id ="city" @bind-Value="newProfile.city"/>
    <InputText id ="state" @bind-Value="newProfile.state"/>
    <InputText id ="SchoolName" @bind-Value="newProfile.schoolName"/>
    <InputText id ="Password" @bind-Value="newProfile.password"/>
    
    
    <button type="submit" class="btn btn-primary">Submit</button>


</EditForm>

          
@**<Form>

    <table class="input-table" style="border-collapse: collapse; border-spacing: 0;">
        <tr>
            <td ><InputText placeholder="Email" class="input-SignUp" @bind-Value="localEmail"/></td>
        </tr>
        <tr>
            <td><InputText placeholder="Username" class="input-SignUp" @bind-Value="localUserName"/></td>
        </tr>
        <tr>
            <td><InputText placeholder="City" class="input-SignUp" @bind-Value="localCity"/></td>
        </tr>
        <tr>
            <td><InputText placeholder="State" class="input-SignUp" @bind-Value="localState"/></td>
        </tr>
        <tr>
            <td><InputText placeholder="School Name" class="input-SignUp" @bind-Value="localSchoolName"/></td>
        </tr>
        <tr>
            <td><InputText placeholder="Password" class="input-SignUp" @bind-Value="passwordTemp1"/></td>
        </tr>
        <tr>
            <td><InputText id="confirmPass" placeholder=@confirmPass class="input-SignUp" @bind-Value="passwordTemp2"/></td>
        </tr>
        <tr>
            <td colspan="2" style="text-align: center;"><!-- Adjust colspan as necessary -->
                <button class="btn btn-primary" @onclick="CheckPasswords" >Submit</button>
            </td>
        </tr>
    </table>

</Form> **@


</body> 

@code {
    
    
    //private string localEmail, localUserName, localCity, localState, localSchoolName, passwordTemp1, passwordTemp2;
    private List<ProfileModel> profile;
    private DisplayProfileModel newProfile = new DisplayProfileModel();


    protected override async Task OnInitializedAsync()
    {
        profile = await _db.GetProfiles();
    }

    //private string passwordTemp1, passwordTemp2;

    private string confirmPass = "Confirm Password";


    /*private async Task CheckPasswords() {
        if (passwordTemp1 == passwordTemp2) {
            await InsertProfile();
        }else {
            confirmPass = "**Passwords must match**";
            passwordTemp2 = "";
        }
    }*/
    
    
    private async Task InsertProfile()
    {
        // Create a new instance of ProfileModel with the provided data
       /* ProfileModel newProfile = new ProfileModel
        {
            email = localEmail,
            password = passwordTemp1, // Assuming passwordTemp1 is the hashed password
            schoolName = localSchoolName,
            city = localCity,
            state = localState
        }; */

        try
        {
            // Create a ProfileModel instance from newProfile (DisplayProfileModel)
            var profileModel = new ProfileModel
            {
                email = newProfile.email,
                password = newProfile.password,
                schoolName = newProfile.schoolName,
                city = newProfile.city,
                state = newProfile.state
            };
            
            // Call the method to insert the new profile into the database
            await _db.InsertProfile(profileModel);

            // Optionally, perform additional actions after successful insertion
            Console.WriteLine($"Profile email: {newProfile.email}");

            // Clear form fields or navigate to another page upon successful insertion
            // Example: ClearForm();

            // Redirect to another page (e.g., home page)
             //NavigationManager.NavigateTo("/home");
        }
        catch (Exception ex)
        {
            // Handle any exceptions (e.g., database error)
            Console.WriteLine("Error inserting profile: " + ex.Message);
            // Display error message to the user, log the error, or perform appropriate error handling
        }
    }


}